{% extends "base.html" %}
{% block content %}
<div class="conversation-layout">
    <!-- Sidebar for item -->
    <div class="chat-container" style="max-width: 280px; align-self: flex-start; padding: 12px 16px;">
        <h3 style="margin-top: 0;">Item</h3>
        <p><strong>Name:</strong> {{ item.name }}</p>
        <p><strong>Description:</strong> {{ item.description }}</p>
        <p><strong>Owner:</strong> {{ item.owner }}</p>
    </div>

    <!-- Main chat area -->
    <div class="chat-container" style="display: flex; flex-direction: column; flex: 1;">
        <h2 style="flex: 0 0 auto;">Chat with {{ other_username }}</h2>

        <div id="message-list" style="flex: 1 1 auto; overflow-y: auto; margin-bottom: 20px;">
            {% for msg in messages %}
            <div class="message {% if msg.sender_id == user_id %}sent{% else %}received{% endif %}">
                <strong>{{ msg.username }}:</strong> {{ msg.content }}<br>
                <small>{{ msg.sent_at }}</small>
            </div>
            {% endfor %}
        </div>

        <form method="post" action="/conversations/{{ conversation_id }}/send" class="message-form"
            style="flex: 0 0 auto; display: flex; flex-direction: row; gap: 10px;">
            <textarea name="content" placeholder="Type your message..." required style="flex: 1;"></textarea>
            <button type="submit">Send</button>
        </form>
    </div>
</div>

<script>
    window.addEventListener('load', function () {
        const messageList = document.getElementById('message-list');
        messageList.scrollTop = messageList.scrollHeight;
    });
</script>
{% endblock %}