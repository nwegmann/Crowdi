{% extends "base.html" %}
{% block content %}
<div style="display: flex; height: 80vh; gap: 20px;">
    <!-- Sidebar for item -->
    <div class="form-container" style="flex: 0 0 250px;">
        <h3 style="margin-top: 0;">Item</h3>
        <p><strong>Name:</strong><br>{{ item.name }}</p>
        <p><strong>Description:</strong><br>{{ item.description }}</p>
        <p><strong>Owner:</strong><br>{{ item.owner }}</p>
    </div>

    <!-- Main chat area -->
    <div class="chat-container" style="display: flex; flex-direction: column; flex: 1;">
        <h2 style="flex: 0 0 auto;">Chat with {{ other_username }}</h2>

        <div id="message-list" style="flex: 1 1 auto; overflow-y: auto; margin-bottom: 20px;">
            {% for sender_id, username, content, sent_at in messages %}
            <div class="message {% if sender_id == user_id %}sent{% else %}received{% endif %}">
                <strong>{{ username }}:</strong> {{ content }}<br>
                <small>{{ sent_at }}</small>
            </div>
            {% endfor %}
        </div>

        <form method="post" action="/conversations/{{ conversation_id }}/send" class="message-form"
            style="flex: 0 0 auto;">
            <textarea name="content" placeholder="Type your message..." required></textarea>
            <button type="submit">Send</button>
        </form>
    </div>
</div>

<script>
    window.addEventListener('load', function () {
        const messageList = document.getElementById('message-list');
        messageList.scrollTop = messageList.scrollHeight;
    });
</script>
{% endblock %}