{% extends "base.html" %}
{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <h1>{{ user.username }}'s Profile</h1>
        <div class="trust-score">
            Trust Score: {{ "%.1f"|format(user.trust_score) }}/10
        </div>
    </div>

    <div class="profile-section">
        <h2>Recent Ratings</h2>
        {% if ratings %}
        {% for rating in ratings %}
        <div class="rating-card">
            <div class="rating-header">
                <span class="rating-value">{{ "%.1f"|format(rating.rating) }}/10</span>
                <span class="rating-date">{{ rating.created_at }}</span>
            </div>
            {% if rating.comment %}
            <p class="rating-comment">{{ rating.comment }}</p>
            {% endif %}
            <div class="rating-author">
                Rated by: {{ rating.rater_username }}
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p>No ratings yet.</p>
        {% endif %}
    </div>

    {% if user_id != user.id %}
    <div class="profile-section">
        <h2>Rate this User</h2>
        <form action="/rate_user" method="post" class="rating-form">
            <input type="hidden" name="rated_id" value="{{ user.id }}">
            <div class="rating-input">
                <label for="rating">Rating:</label>
                <div class="likert-slider-container">
                    <input type="range" name="rating" id="likert-slider" min="1" max="5" step="0.01" value="3" required
                        oninput="updateLikertValue(this.value)">
                    <div class="likert-slider-value">
                        <span id="likert-value">3</span> - <span id="likert-text">Neutral</span>
                    </div>
                </div>
            </div>
            <div class="rating-input">
                <label for="comment">Comment (optional):</label>
                <textarea name="comment" rows="3"></textarea>
            </div>
            <button type="submit">Submit Rating</button>
        </form>
    </div>
    {% endif %}

    <div class="profile-actions">
        {% if user_id == user.id %}
        <form method="post" action="/delete_account"
            onsubmit="return confirm('Are you sure you want to delete your account? This action cannot be undone.');">
            <button type="submit" class="delete-account-button">Delete Account</button>
        </form>
        {% endif %}
    </div>
</div>

<script>
    function updateLikertValue(val) {
        document.getElementById('likert-value').textContent = parseFloat(val).toFixed(2);
        let label = '';
        if (val < 1.5) label = 'Very Dissatisfied';
        else if (val < 2.5) label = 'Dissatisfied';
        else if (val < 3.5) label = 'Neutral';
        else if (val < 4.5) label = 'Satisfied';
        else label = 'Very Satisfied';
        document.getElementById('likert-text').textContent = label;
    }
</script>
{% endblock %}