<h2>Items to Borrow</h2>
<div class="filter-container">
    <form action="/" method="get" class="filter-form">
        <input type="hidden" name="tab" value="borrow"> <!-- Always indicate current tab -->
        <input type="text" name="search" placeholder="Search items..."
            value="{{ request.query_params.get('search', '') }}">
        <select name="origin_city">
            <option value="">Any location</option>
            {% for city in cities %}
            <option value="{{ city }}" {% if origin_city==city %}selected{% endif %}>{{ city }}</option>
            {% endfor %}
        </select>

        <input type="number" name="radius" min="1" max="100" value="{{ radius if radius else '' }}" placeholder="km">
        <button type="submit">Filter</button>
        <button class="reset-filter">Reset</button>
    </form>
</div>
<div class="item-grid">
    {% if items %}
    {% for item in items %}
    <div class="item-card">
        <h3>{{ item.name }}</h3>
        <p>{{ item.description }}</p>
        {% if item.image_path %}
        <img src="{{ request.url_for('static', path=item.image_path.startswith('uploads/') and item.image_path or 'uploads/' ~ item.image_path) }}"
            alt="{{ item.name }} image" class="img-thumb">
        {% endif %}
        <p><strong>Owner:</strong> {{ item.username }}</p>
        {% if item.city %}
        <p><strong>Location:</strong> {{ item.city }}</p>
        {% endif %}
        {% if item.hashtags %}
        <div class="hashtags">
            {% for tag in item.hashtags.split(",") %}
            <span class="hashtag-bubble">{{ tag.strip() }}</span>
            {% endfor %}
        </div>
        {% endif %}
        {% if user_id and item.owner_id|int != user_id|int %}
        <form method="post" action="/start_conversation">
            <input type="hidden" name="item_id" value="{{ item.id }}">
            <input type="hidden" name="other_user_id" value="{{ item.owner_id }}">
            <button type="submit">Contact</button>
        </form>
        {% endif %}
    </div>
    {% endfor %}
    {% else %}
    <p>No items available to borrow at the moment.</p>
    {% endif %}
</div>